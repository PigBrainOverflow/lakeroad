import lit.formats
import os
import shutil
import tempfile
import subprocess
from pathlib import Path

# If FileCheck isn't on the path, then use llvm-config (pointed to by
# LLVM_CONFIG) to put it in the path.
llvm_bindir = ""
if not shutil.which("FileCheck"):
    assert "LLVM_CONFIG" in os.environ,
        "Please install LLVM, and set LLVM_CONFIG to the path to your llvm-config binary, e.g. /usr/local/Cellar/llvm/13.0.1_1/bin/llvm-config."
    llvm_bindir = (
        subprocess.check_output(
            [os.environ["LLVM_CONFIG"], "--bindir"],
        )
        .decode("utf-8")
        .strip()
    )

lakeroad_dir = os.environ["LAKEROAD_DIR"]
assert lakeroad_dir, "LAKEROAD_DIR must be set to the base directory of Lakeroad."

config.name = "Utils tests"
config.test_format = lit.formats.ShTest(True) # True so that we use external shell.
config.environment = {
    "LAKEROAD_DIR": lakeroad_dir,
    "PATH": llvm_bindir + ":" + os.environ["PATH"],
}
config.suffixes = [".v"]
